import "pe"

rule DetectUPXPacked {
    meta:
        description = "Detects files packed with UPX, a common packer used by malware."
        author = "YourName"
    strings:
        $upx = "UPX!" ascii wide nocase
    condition:
        pe.is_pe and $upx
}

rule SuspiciousImports {
    meta:
        description = "Detects suspicious API imports by scanning for key function names."
        author = "YourName"
    strings:
        $virtualalloc   = "VirtualAlloc" ascii wide nocase
        $writeprocess   = "WriteProcessMemory" ascii wide nocase
        $createremote   = "CreateRemoteThread" ascii wide nocase
        $loadlibrarya   = "LoadLibraryA" ascii wide nocase
        $getprocaddress = "GetProcAddress" ascii wide nocase
    condition:
        pe.is_pe and any of ($virtualalloc, $writeprocess, $createremote, $loadlibrarya, $getprocaddress)
}

rule SuspiciousExecutableSection {
    meta:
        description = "Detects executable sections in a PE file that are not the standard .text section."
        author = "YourName"
    condition:
        pe.is_pe and
        for any section in pe.sections : (
            (section.characteristics & 0x20000000) and
            (section.name != ".text")
        )
}

rule DetectPackedExecutable {
    meta:
        description = "Detects files that appear to be packed using common packers like UPX, ASPack, or Themida."
        author = "YourName"
    strings:
        $upx    = "UPX!" ascii wide nocase
        $aspack = "ASPack" ascii wide nocase
        $themida= "Themida" ascii wide nocase
    condition:
        pe.is_pe and any of ($upx, $aspack, $themida)
}
